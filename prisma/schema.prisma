generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider  = "postgresql"
}

model User {
  id        String   @id @default(uuid())
  name      String
  username  String   @unique
  password  String
  role      Role     @default(OPERATOR)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  activities ActivityLog[]

  @@map("users")
}

model AsetTower {
  id                     String                @id @default(uuid())
  kodeSap                Int                   @default(10100)
  kodeUnit               Int                   @default(3215)
  deskripsi              String?
  luasTanah              Float?
  tahunPerolehan         Int?
  alamat                 String?
  desa                   String?
  kecamatan              String?
  kabupaten              String?
  provinsi               String?
  koordinatX             Float?
  koordinatY             Float?
  jenisBangunan          JenisBangunan
  jenisDokumen           String?
  nomorSertifikat        String?
  tanggalAwalSertifikat  DateTime?
  tanggalAkhirSertifikat DateTime?
  linkSertifikat         String?
  penguasaanTanah        StatusPenguasaanTanah
  updatedAt              DateTime              @updatedAt
  createdAt              DateTime              @default(now())
  permasalahanAset       String?
  fotoAset               FotoAset[]

  @@index([koordinatY, koordinatX])
  @@index([kodeSap])
  @@index([createdAt])
  @@index([deskripsi])
  @@map("aset_towers")
}

model FotoAset {
  id          String    @id @default(uuid())
  url         String
  kategori    String?
  deskripsi   String?
  uploadedAt  DateTime  @default(now())
  asetTowerId String
  asetTower   AsetTower @relation(fields: [asetTowerId], references: [id], onDelete: Cascade)

  @@map("foto_asets")
}

enum Role {
  SUPER_ADMIN
  OPERATOR
  MASTER
  ADMIN
}

enum StatusPenyelesaianAset {
  BELUM_TERBIT_SERTIFIKAT
  SUDAH_TERBIT_SERTIFIKAT
}

enum StatusPenguasaanTanah {
  DIKUASAI
  TIDAK_DIKUASAI
}

enum JenisBangunan {
  GARDU_INDUK
  TAPAK_TOWER
}

enum PermasalahanAset {
  CLEAN_AND_CLEAR
  TUMPAK_TINDIH
}

model ActivityLog {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  action    String   // e.g. "IMPORT", "CREATE", "UPDATE", "DELETE"
  details   String?  // JSON string or text description
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
  @@map("activity_logs")
}
